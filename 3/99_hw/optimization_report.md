# CPU 

1. ![img.png](images/img.png)

    regexp.compile, занимает 61% от всей работы

2. ![img_1.png](images/img_1.png)

    Большое количество аллокаций, в т.ч. от regexp    

3. ![img_2.png](images/img_2.png)

    Анмаршалинг занимает 26% от всей работы

4. ![img_5.png](images/img_5.png)

    Анмаршалинг в коде

5. ![img_6.png](images/img_6.png)
    
    Создание регекспа в коде

6. ![img_7.png](images/img_7.png)

    Создание второго регекспа в коде

7. ![img_8.png](images/img_8.png)

    Стоит ли использовать регексп, если можно использовать строки?

8. ![img_9.png](images/img_9.png)

    Нужно ли читать весь файл целиком?

# Memory

1. ![img_3.png](images/img_3.png)

    Проверка соответствия строке занимает 66% памяти

2. ![img_4.png](images/img_4.png)
    
    Чтение целиком занимает 16% памяти

3. ![img_10.png](images/img_10.png)

    На операции с регексп и чтение всего файла приходится 65% памяти

4. ![img_11.png](images/img_11.png)

    26.60 МБ на чтение файла целиком

5. ![img_12.png](images/img_12.png)

    Перевод контента к строке и разделение по \n. Мб лучше просто читать построчно? Мб можно узнать сразу сколько строк, и предаллоцировать место под строки. 

6. ![img_13.png](images/img_13.png)

    Анмаршалинг

7. ![img_14.png](images/img_14.png)

    Создание регекспа

8. ![img_15.png](images/img_15.png)

    Создание регекспа 2

9. ![img_16.png](images/img_16.png) ![img_20.png](images/img_20.png)

    Можно ли что-то сделать с Sprintf? Мы постоянно конкатенируем => можно использовать стрингбилдер. Для замены 1 символа на строка можно использовать не регексп?

# Оптимизации

1. При помощи go test -bench . -benchmem и бенчмарков BenchmarkRegexpReplaceString, BenchmarkStringsReplaceString увидели, что для замены лучше использовать строки вместо регекспа

    ![img_17.png](images/img_17.png) 

2. `regexp.MatchString("Android", browser)` и `regexp.MatchString("MSIE", browser)` по сути проверяют, что в browser содержится строка "Android", но при этом каждый раз внутри себя создает структуру для парсинга регекспа. Лучше использовать strings.Contains:

    ![img_18.png](images/img_18.png)

3. Вместо считывания файла целиком и хождения по каждой строчке, будем читать построчно и сразу обрабатывать, создавая юзеров. 

    ![img_21.png](images/img_21.png)

4. Вместо того чтобы заполнять отдельно юзеров, а потом по них проходиться, будем сразу обрабатывать юзера, как создали его.

5. Происходит проход по слайсу браузеров дважды, можно сделать это единожды:

    ![img_25.png](images/img_25.png)

6. Переменная uniqueBrowsers не используется

    ![img_28.png](images/img_28.png)

# Промежуточные результаты

## После оптимизаций 1 и 2

![img_19.png](images/img_19.png)

## После оптимизации 3

![img_22.png](images/img_22.png)

## После оптимизации 4

![img_23.png](images/img_23.png)

## После оптимизации 5

![img_26.png](images/img_26.png)

